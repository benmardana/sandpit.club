---
import { SEO } from 'astro-seo';
import '../assets/app.css';

// Capture build date as proxy for last deployment date
const buildDate = new Date();
const formattedDate = buildDate.toLocaleDateString('en-AU', {
  day: 'numeric',
  month: 'short',
  year: 'numeric',
});

// Meetup location data
interface MeetupLocation {
  name: string;
  address: string;
  lat: number;
  lng: number;
}

const meetupLocations: Record<string, MeetupLocation> = {
  beaton_reserve: {
    name: 'Beaton Reserve Sandpit',
    address: 'Beaton Reserve, Yarraville VIC 3013',
    lat: -37.81645,
    lng: 144.88725,
  },
};

// Generate map URLs for different services
function getMapUrls(location: MeetupLocation) {
  const { name, address, lat, lng } = location;
  const encodedAddress = encodeURIComponent(`${name}, ${address}`);
  const encodedName = encodeURIComponent(name);
  
  return {
    google: `https://www.google.com/maps/search/?api=1&query=${lat},${lng}&query_place_id=${encodedName}`,
    apple: `https://maps.apple.com/?q=${encodedName}&ll=${lat},${lng}&address=${encodeURIComponent(address)}`,
    openstreetmap: `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}&zoom=17#map=17/${lat}/${lng}`,
    waze: `https://www.waze.com/ul?ll=${lat},${lng}&navigate=yes&zoom=17`,
  };
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <SEO
      title="Sandpit Club"
      titleTemplate="%s | Melbourne Dads Community"
      description="Connect with other dads in Melbourne for playdates, activities and community. Join Sandpit Club for regular meetups, a social group for dads and kids, and a supportive environment."
      canonical="https://sandpit.club"
      openGraph={{
        basic: {
          title: 'Sandpit Club | Melbourne Dads Community',
          type: 'website',
          image: 'https://sandpit.club/opengraph.png',
          url: 'https://sandpit.club',
        },
        optional: {
          description:
            'Connect with other dads in Melbourne for playdates, activities and community. Join Sandpit Club for regular meetups, a social group for dads and kids, and a supportive environment.',
          siteName: 'Sandpit Club',
          locale: 'en_AU',
        },
        image: {
          alt: 'Sandpit Club logo',
          width: 1200,
          height: 630,
        },
      }}
      twitter={{
        card: 'summary_large_image',
        title: 'Sandpit Club | Melbourne Dads Community',
        description:
          'Connect with other dads in Melbourne for playdates, activities and community. Join Sandpit Club for regular meetups, a social group for dads and kids, and a supportive environment.',
        image: 'https://sandpit.club/opengraph.png',
        imageAlt: 'Sandpit Club logo',
      }}
    />
  </head>
  <body class="min-h-screen min-w-screen bg-base-100">
    <main>
      <div class="hero min-h-[calc(100vh-44px)]">
        <div class="hero-content text-center">
          <div>
            <div>
              <h1 class="text-8xl font-bold">
                Sandpit Club<span class="badge badge-success align-top mt-4"
                  >New</span
                >
              </h1>
            </div>
            <p class="mt-16 text-2xl font-semibold">
              Connect with other dads in the Yarraville area
            </p>
            <p class="mt-8 text-2xl font-semibold">Kids of all ages welcome</p>
            <p class="mt-8 text-2xl font-semibold">Coffee and play in a park</p>
            <p class="mt-8 text-2xl font-semibold">Regular Meetups Planned</p>
          </div>
        </div>
      </div>
      <div class="card bg-base-100 max-w-140 mx-auto">
        <div class="card-body">
          <h2 class="card-title">Upcoming meetups</h2>
          <ul class="space-y-2 text-left">
            <li>
              <span class="font-semibold">Sat 24 Jan Â· 10:00am</span>
              <span class="block text-sm text-base-content/70">
                Beaton Reserve Sandpit, Yarraville â€“ casual play and coffee
              </span>
              <!-- Map Links Dropdown -->
              <div class="dropdown dropdown-end mt-2">
                <button tabindex="0" class="btn btn-sm btn-outline gap-2" aria-label="Get directions to Beaton Reserve Sandpit">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  Get Directions
                </button>
                <ul tabindex="0" class="dropdown-content menu bg-base-200 rounded-box z-10 w-56 p-2 shadow-lg mt-1">
                  <li class="menu-title text-xs">Open in...</li>
                  <li>
                    <a 
                      href={getMapUrls(meetupLocations.beaton_reserve).google}
                      target="_blank" 
                      rel="noopener noreferrer"
                      class="map-link"
                      data-map-service="google"
                    >
                      <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                      </svg>
                      Google Maps
                    </a>
                  </li>
                  <li>
                    <a 
                      href={getMapUrls(meetupLocations.beaton_reserve).apple}
                      target="_blank" 
                      rel="noopener noreferrer"
                      class="map-link"
                      data-map-service="apple"
                    >
                      <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                      </svg>
                      Apple Maps
                    </a>
                  </li>
                  <li>
                    <a 
                      href={getMapUrls(meetupLocations.beaton_reserve).openstreetmap}
                      target="_blank" 
                      rel="noopener noreferrer"
                      class="map-link"
                      data-map-service="openstreetmap"
                    >
                      <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                      </svg>
                      OpenStreetMap
                    </a>
                  </li>
                  <li>
                    <a 
                      href={getMapUrls(meetupLocations.beaton_reserve).waze}
                      target="_blank" 
                      rel="noopener noreferrer"
                      class="map-link"
                      data-map-service="waze"
                    >
                      <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.54 6.63c-1.07-4.12-5.19-5.98-9.26-5.63-4.46.38-8.33 3.53-8.61 8.06-.17 2.74.66 5.17 2.12 7.19-.08.73-.2 1.45-.36 2.17-.22.97.78 1.77 1.69 1.32 1.16-.57 2.26-1.21 3.29-1.92 1.66.48 3.41.56 5.12.14 4.56-1.11 7.5-5.47 6.67-10.02-.12-.66-.38-1.29-.66-1.31zm-8.13 9.24a1.31 1.31 0 110-2.62 1.31 1.31 0 010 2.62zm3.93 0a1.31 1.31 0 110-2.62 1.31 1.31 0 010 2.62zm-.65-5.25c0 .73-.58 1.31-1.31 1.31s-1.31-.58-1.31-1.31v-.66c0-.73.58-1.31 1.31-1.31s1.31.58 1.31 1.31v.66zm-3.93 0c0 .73-.58 1.31-1.31 1.31s-1.31-.58-1.31-1.31v-.66c0-.73.58-1.31 1.31-1.31s1.31.58 1.31 1.31v.66z"/>
                      </svg>
                      Waze
                    </a>
                  </li>
                  <li class="border-t border-base-300 mt-2 pt-2">
                    <button 
                      class="copy-address-btn"
                      data-address={`${meetupLocations.beaton_reserve.name}, ${meetupLocations.beaton_reserve.address}`}
                    >
                      <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                      </svg>
                      <span class="copy-text">Copy Address</span>
                    </button>
                  </li>
                </ul>
              </div>
            </li>
            <li class="mt-4">
              <div class="skeleton h-4 w-36"></div>
              <div class="skeleton h-4 w-82 mt-2"></div>
            </li>
            <li class="mt-4 text-sm text-base-content/70">
              More dates coming soon.
            </li>
          </ul>
        </div>
      </div>
      <footer
        class="footer sm:footer-horizontal footer-center bg-base-300 text-base-content p-4 mt-16"
      >
        <aside class="flex items-center gap-4">
          <a class="link" href="mailto:hello@sandpit.club">hello@sandpit.club</a>
          <button class="link" onclick="about_modal.showModal()">About</button>
        </aside>
        <aside class="text-sm text-base-content/60">
          Last updated: {formattedDate}
        </aside>
      </footer>

      <!-- About Modal -->
      <dialog id="about_modal" class="modal">
        <div class="modal-box">
          <h3 class="text-lg font-bold">Hello ðŸ‘‹ Ben here,</h3>
          <p class="py-4">
            I'm a Yarraville local with 2 kids â€“ a toddler and a newborn. I started Sandpit Club to bring together Dads in the area in a casual setting to share our experiences and get our kids playing together. Let's support each other and our kids.
          </p>
          <p class="py-2">
            You can learn a bit more about me and confirm I'm a real person at my personal website
          </p>
          <a class="link link-primary" href="https://benmardana.com" target="_blank" rel="noopener noreferrer">
            benmardana.com
          </a>
          <div class="modal-action">
            <form method="dialog">
              <button class="btn">Close</button>
            </form>
          </div>
        </div>
        <form method="dialog" class="modal-backdrop">
          <button>close</button>
        </form>
      </dialog>
    </main>
    <script src="https://cdn.counter.dev/script.js" data-id="107c94ce-cfbd-451c-942e-9fb72048e8a7" data-utcoffset="11"></script>
    
    <!-- Map Links JavaScript -->
    <script>
      // Handle copy address buttons
      document.querySelectorAll('.copy-address-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.preventDefault();
          const address = btn.getAttribute('data-address');
          const copyText = btn.querySelector('.copy-text');
          
          try {
            await navigator.clipboard.writeText(address);
            const originalText = copyText.textContent;
            copyText.textContent = 'Copied!';
            btn.classList.add('text-success');
            
            setTimeout(() => {
              copyText.textContent = originalText;
              btn.classList.remove('text-success');
            }, 2000);
          } catch (err) {
            console.error('Failed to copy address:', err);
            copyText.textContent = 'Failed to copy';
            setTimeout(() => {
              copyText.textContent = 'Copy Address';
            }, 2000);
          }
        });
      });

      // Store user's preferred map service
      document.querySelectorAll('.map-link').forEach(link => {
        link.addEventListener('click', () => {
          const service = link.getAttribute('data-map-service');
          if (service) {
            localStorage.setItem('preferredMapService', service);
          }
        });
      });

      // Highlight preferred map service if one is saved
      const preferredService = localStorage.getItem('preferredMapService');
      if (preferredService) {
        document.querySelectorAll(`.map-link[data-map-service="${preferredService}"]`).forEach(link => {
          const badge = document.createElement('span');
          badge.className = 'badge badge-xs badge-primary ml-auto';
          badge.textContent = 'Preferred';
          link.appendChild(badge);
        });
      }
    </script>
  </body>
</html>
